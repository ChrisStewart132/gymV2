<!-- gymV2 app
    gym exercise app using data scraped from the weight training guide website
    
HOME
    exercises are loaded from local files,
    exercises can be filtered by equipment, target muscle, synergist muscles, and force (push vs pull)
USER 
    exercises can be saved (with a visual cue i.e css color scheme) to local storage and viewed on a user page
    exercises can have multiple notes saved (to local sotrage) and attached to their block (TODO)
    exercises can include sets,reps completed (TODO)
    user mode filtering 

long range possibilities:
    save exercises with meta data and date worked with sets reps...
        graph page to visualize muscle groups worked etc
    improve scraped data quality (filtering)
    improve filtering
    add exercises
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymV2</title>
    <style>
        * {
            border: 0px solid rgb(16, 16, 16);
            color: white;  
            background-color: black;
            text-align: center;
            margin: 0px;
            vertical-align: middle;
        }
        body {
            background-color: black;
            overflow: auto; 
        }
        .container {
            border: 1px solid rgb(16, 16, 16);
            margin-bottom: 150px;
        }

        h1{padding: 3px;}
        .exercise {
            padding: 10px;
            background-color: rgb(22, 22, 22);
            display: inline-block;
            margin: 10px;
            border-radius: 12px;
            max-width: 540px;
        }
        .saved {
            background-color: darkgreen;
        }
        .hidden{
            display: none;
        }
        p, span{ 
            padding: 2px;
            font-size: medium;
        }
        .tag {
            border: 1px solid gray;
            padding: 1px;
            margin: 2px;
            font-size: smaller;
        }
        #details > p {
            text-align: left;
        }
        img {
            width: auto;
            height: 360px;
        }
        select{
            color:black;
            background-color: white;
        }
        input:hover{
            background-color: white;
            color: black;
        }
    </style>
</head>
<body>
    <div>
        <label for="equipment">equipment:</label>
        <select name="equipment" id="equipment">
            <option value="empty"></option>
        </select> 

        <label for="TargetMuscleFilter">target muscle:</label>
        <select name="TargetMuscleFilter" id="TargetMuscleFilter">
            <option value="empty"></option>
        </select> 

        <label for="SynergistMuscleFilter">synergist muscle:</label>
        <select name="SynergistMuscleFilter" id="SynergistMuscleFilter">
            <option value="empty"></option>
        </select> 

        <label for="ForceSelection">force:</label>
        <select name="ForceSelection" id="ForceSelection">
            <option value="empty"></option>
        </select> 
        <input type="submit" value="APPLY FILTER" onclick="applyFilter()">
        <input TYPE="submit" id="userMode" onclick="userMode(this)" value="USER MODE">
        <input TYPE="submit" onclick="reset()" value="RESET">
    </div>

    <div class="container">
        <!-- template exercise block to be duplicated -->
        <div class="exercise" onclick="selectExercise(this)">
            <h1 id="name">NAME</h1>
            <img src="data/scraped/90-degree crunch on bench.webp"><br>
            <div id="details">
                <p id="TargetMuscle">Target muscle: </p>
                <p id="Synergists">Synergists: </p>
                <p id="Mechanics">Mechanics: </p>
                <p id="Force">Force: </p>
            </div>
            <div id="tags">
                <span>tag0</span>
                <span>tag1</span>
                <span>tag...</span>
            </div>
        </div>
    </div>


    <script>
        const CONTAINER = document.querySelector(`.container`);
        load_filters();
        load_exercises();

        function userMode(element){
            if(element.classList.contains(`saved`)){
                element.classList.remove(`saved`)
                applyFilter()
                return;
            }

            element.classList.add(`saved`)
            for(const exercise of CONTAINER.children){
                const key = exercise.querySelector(`#name`).textContent
                if(localStorage.getItem(key) !== "1"){
                    exercise.classList.add(`hidden`)
                }else{
                    exercise.classList.remove(`hidden`)
                }
            }
            applyFilter()
        }

        function reset(){
            if(!confirm("Are you sure?"))
                return;
            localStorage.clear()
            for(const exercise of CONTAINER.children){
                exercise.classList.remove(`saved`)
                exercise.classList.remove(`hidden`)
            }
        }

        function selectExercise(exercise_element){
            if(exercise_element.classList.contains(`saved`)){
                exercise_element.classList.remove(`saved`)
                unsaveExercise(exercise_element)
            } else {
                exercise_element.classList.add(`saved`)
                saveExercise(exercise_element)
            }
        }
        function saveExercise(exercise_element){
            const key = exercise_element.querySelector(`#name`).textContent
            const value = "1"
            localStorage.setItem(key, value)
        }
        function unsaveExercise(exercise_element){
            const key = exercise_element.querySelector(`#name`).textContent
            localStorage.removeItem(key)
        }


        async function load_filters(){
            load_equipment_filter()
            load_target_muscle_filter()
            load_synergist_muscle_filter()
            load_forces_filter()
        }
        async function load_forces_filter(){
            const obj = await fetch(`data/forces.json`).then(r=>r.json());
            const target_muscles_select = document.getElementById(`ForceSelection`)
            obj["forces"].forEach((e)=>{
                const option = document.createElement(`option`)
                option.textContent = e;
                option.value = e;
                target_muscles_select.appendChild(option);
            })
        }
        async function load_equipment_filter(){
            const obj = await fetch(`data/equipment_tags.json`).then(r=>r.json());
            const target_muscles_select = document.getElementById(`equipment`)
            obj["equipment"].forEach((e)=>{
                const option = document.createElement(`option`)
                option.textContent = e;
                option.value = e;
                target_muscles_select.appendChild(option);
            })
        }
        async function load_synergist_muscle_filter(){
            const obj = await fetch(`data/synergists.json`).then(r=>r.json());
            const target_muscles_select = document.getElementById(`SynergistMuscleFilter`)
            obj["synergists"].forEach((e)=>{
                const option = document.createElement(`option`)
                option.textContent = e;
                option.value = e;
                target_muscles_select.appendChild(option);
            })
        }
        async function load_target_muscle_filter(){
            const target_muscles_obj = await fetch(`data/target_muscles.json`).then(r=>r.json());
            const target_muscles_select = document.getElementById(`TargetMuscleFilter`)
            target_muscles_obj["target muscles"].forEach((e)=>{
                const option = document.createElement(`option`)
                option.textContent = e;
                option.value = e;
                target_muscles_select.appendChild(option);
            })
        }


        async function load_exercises(){
            names_obj = await fetch("/data/names.json").then(response => response.json());
            names_obj.names.forEach((name, index, arr) => {
                if(index < 33 || true){
                    //console.log(name);
                    load_exercise(name);
                }     
            });
            // remove/hide the template exercise when complete
            //CONTAINER.removeChild(CONTAINER.children[0]);
            CONTAINER.children[0].classList.add(`hidden`)
        }
        async function load_exercise(name){
            const exercise_element = await create_exercise_element(name);
            const key = name
            if(localStorage.getItem(key) === "1"){
                exercise_element.classList.add(`saved`)
            }
            CONTAINER.appendChild(exercise_element);
        }
        async function create_exercise_element(name){
            const template = CONTAINER.querySelector(`.exercise`);
            let exercise_element = template.cloneNode(true);
            exercise_element.querySelector('#name').textContent = name; 

            const metadata = await fetch(`data/scraped/${name}.json`).then(r => r.json());
            //console.log(metadata)
            exercise_element.querySelector('img').src = `data/scraped/${name}.webp`

            exercise_element.querySelector('#TargetMuscle').textContent += metadata[`Target muscle`]
            exercise_element.querySelector('#Synergists').textContent += metadata[`Synergists`]
            exercise_element.querySelector('#Mechanics').textContent += metadata[`Mechanics`]
            exercise_element.querySelector('#Force').textContent += metadata[`Force`]

            const tags = exercise_element.querySelector('#tags');
            for(let i = tags.childElementCount-1; i > -1; i--){
                tags.removeChild(tags.children[i])
            }
            metadata.tags.forEach((tag => {
                const element = document.createElement(`span`);
                element.classList.add(`tag`)
                element.textContent = tag;
                tags.appendChild(element);
            }))
            return exercise_element;
        }

        async function applyFilter(){
            const userModeElement = document.getElementById(`userMode`)
            if(!userModeElement.classList.contains(`saved`)){// not in user mode
                await resetFilter();
            }else{// user mode
                Array.from(CONTAINER.children).forEach(e => {
                    const key = e.querySelector(`#name`).textContent
                    if(localStorage.getItem(key) === "1")
                        e.classList.remove(`hidden`)
                })
            }
            await applyEquipmentFilter();
            await applyForceFilter();
            await applyTargetFilter();
            await applySynergistFilter();     
        }
        async function resetFilter(){
            Array.from(CONTAINER.children).forEach(e => e.classList.remove(`hidden`))
        }
        async function applyEquipmentFilter(){
            const filter = document.getElementById("equipment")
            //.log(filter.value)
            if(filter.value != 'empty'){
                Array.from(CONTAINER.children).forEach((e,i)=>{
                    if(e.classList.contains(`hidden`)){
                        return;   
                    }
                    const tags = e.querySelector(`#tags`)
                    const arr = Array.from(tags.children, e => e.textContent)
                    if(!arr.includes(filter.value)){
                        e.classList.add(`hidden`)
                    }
                })
            }
        }
        async function applyForceFilter(){
            const filter = document.getElementById("ForceSelection")
            //console.log(filter.value)
            if(filter.value != 'empty'){
                Array.from(CONTAINER.children).forEach((e,i)=>{
                    if(e.classList.contains(`hidden`)){
                        return;   
                    }
                    const str = e.querySelector(`#Force`).textContent
                    if(!str.includes(filter.value)){
                        e.classList.add(`hidden`)
                    }
                })
            }
        }
        async function applyTargetFilter(){
            const filter = document.getElementById("TargetMuscleFilter")
            //console.log(filter.value)
            if(filter.value != 'empty'){
                Array.from(CONTAINER.children).forEach((e,i)=>{
                    if(e.classList.contains(`hidden`)){
                        return;   
                    }
                    const str = e.querySelector(`#TargetMuscle`).textContent
                    if(!str.includes(filter.value)){
                        e.classList.add(`hidden`)
                    }
                })
            }
        }
        async function applySynergistFilter(){
            const filter = document.getElementById("SynergistMuscleFilter")
            //console.log(filter.value)
            if(filter.value != 'empty'){
                Array.from(CONTAINER.children).forEach((e,i)=>{
                    if(e.classList.contains(`hidden`)){
                        return;   
                    }
                    const str = e.querySelector(`#Synergists`).textContent
                    if(!str.includes(filter.value)){
                        e.classList.add(`hidden`)
                    }
                })
            }
        }

    </script>
</body>
</html>
